<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>UVCI Connect - Observatoire de la Pr√©sence Universitaire</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --uvci-purple: #6a1b9a;
            --uvci-green: #2ecc71;
        }

        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            font-family: 'Segoe UI', sans-serif;
            background: #fdfdfd;
        }

        /* HEADER */
        header {
            height: 70px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 2000;
        }

        .header-title {
            color: var(--uvci-purple);
            font-weight: bold;
            font-size: 20px;
        }

        .header-logo {
            height: 50px;
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* SIDEBARS */
        .sidebar-left {
            width: 320px;
            background: white;
            border-right: 1px solid #eee;
            display: flex;
            flex-direction: column;
            padding: 25px;
            overflow-y: auto;
        }

        .sidebar-right {
            width: 320px;
            background: white;
            border-left: 1px solid #eee;
            display: flex;
            flex-direction: column;
            padding: 25px;
            overflow-y: auto;
        }

        .card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .card h3 {
            margin: 0 0 10px 0;
            font-size: 13px;
            color: var(--uvci-purple);
            text-transform: uppercase;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 5px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            font-size: 12px;
        }

        /* CARTE */
        #map {
            flex: 1;
            z-index: 1;
            background: #f0f4f0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            font-size: 13px;
        }

        .legend-icon {
            width: 14px;
            height: 14px;
            margin-right: 10px;
            border-radius: 50%;
        }

        .btn-export {
            width: 100%;
            padding: 10px;
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            color: #555;
            transition: 0.3s;
        }

        .btn-export:hover {
            background: var(--uvci-purple);
            color: white;
        }

        /* POPUP STYLE */
        .popup-box {
            width: 220px;
            text-align: center;
        }

        .img-round {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--uvci-purple);
            object-fit: cover;
            margin: 0 auto 10px;
            display: block;
        }

        .popup-info {
            text-align: left;
            font-size: 11px;
            line-height: 1.4;
            color: #444;
            border-top: 1px solid #eee;
            padding-top: 8px;
        }
    </style>
</head>
<body>

    <header>
        <div class="header-title">UVCI Connect: <span style="font-weight: normal; color: #555;">Observatoire de la Pr√©sence Universitaire</span></div>
        <img src="IdkpP2Gr.png" class="header-logo">
    </header>

    <div class="main-container">
        <div class="sidebar-left">
            <div class="card" style="background: var(--uvci-purple); color: white;">
                <h3 style="color: white; border-bottom-color: rgba(255,255,255,0.2);">üìä Population</h3>
                <div style="font-size: 28px; font-weight: bold;" id="total-count">0</div>
                <div style="font-size: 11px; opacity: 0.8;">√âtudiants filtr√©s</div>
            </div>

            <div class="card">
                <h3>üîç Recherche</h3>
                <input type="text" id="search" placeholder="Nom ou ville..." style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;" onkeyup="filtrer()">
            </div>

            <div class="card">
                <h3>üéì Niveaux d'√©tude</h3>
                <div class="filter-grid">
                    <label><input type="checkbox" class="f-niv" value="Licence 1" onchange="filtrer()"> L1</label>
                    <label><input type="checkbox" class="f-niv" value="Licence 2" onchange="filtrer()"> L2</label>
                    <label><input type="checkbox" class="f-niv" value="Licence 3" onchange="filtrer()"> L3</label>
                    <label><input type="checkbox" class="f-niv" value="Master 1" onchange="filtrer()"> M1</label>
                    <label><input type="checkbox" class="f-niv" value="Master 2" onchange="filtrer()"> M2</label>
                    <label><input type="checkbox" class="f-niv" value="Doctorat" onchange="filtrer()"> Doctorat</label>
                </div>
            </div>

            <div class="card">
                <h3>üöª Genre</h3>
                <div class="filter-grid">
                    <label><input type="checkbox" class="f-genre" value="Masculin" onchange="filtrer()"> Hommes</label>
                    <label><input type="checkbox" class="f-genre" value="F√©minin" onchange="filtrer()"> Femmes</label>
                </div>
            </div>

            <div class="card">
                <h3>üìä Statistiques Genre</h3>
                <canvas id="genreChart" height="150"></canvas>
                <div id="stat-text" style="font-size: 11px; text-align: center; margin-top: 5px;"></div>
            </div>

            <button class="btn-export" onclick="exportData()">üì• Exporter vers Excel (CSV)</button>
        </div>

        <div id="map"></div>

        <div class="sidebar-right">
            <div class="card">
                <h3>L√©gende</h3>
                <div class="legend-item"><div class="legend-icon" style="background: var(--uvci-green);"></div> √âtudiant</div>
                <div class="legend-item"><div class="legend-icon" style="background: var(--uvci-purple);"></div> Communaut√©</div>
                <div class="legend-item"><i class="fa-solid fa-graduation-cap" style="margin-right:10px;"></i> Si√®ge UVCI</div>
            </div>

            <div style="flex-grow: 1; display: flex; align-items: center; justify-content: center; min-height: 250px;">
                <img src="carte-3d-cote-ivoire-drapeau-national_97886-6567.avif" style="width: 100%; max-width: 260px;">
            </div>

            <div style="padding: 15px; background: #fcfaff; border-radius: 8px; font-size: 13px; color: var(--uvci-purple); border-left: 4px solid var(--uvci-purple);">
                <strong>Passage de Flambeau</strong><br>
                <small>Promotion L3 - 2026</small>
                <p style="font-style: italic; margin-top: 5px; font-size: 11px;">"B√¢tir ensemble l'excellence num√©rique."</p>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Tes donn√©es JSON ici (copie celles de ton fichier)
        var mesDonnees = {"type":"FeatureCollection","features":[{"type":"Feature","id":"donneetudiant.1","geometry":{"type":"Point","coordinates":[-4.373856,5.331807]},"geometry_name":"wkb_geometry","properties":{"nom":"N'DRI OHOUSSOU MO√èSE EMMANUEL","genre":"Masculin","email":"ohoussou2.ndri@uvci.edu.ci","niveau":"Licence 3","specialite":"ISN-STG","photo":"IMG_20251022_105217_326~2-22_53_16.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/655712371/attachments/attgPZwoZ96jUgCrRMaHZQBn/","ville":"DABOU","ville_1":null,"commune":null,"quartier":"Quartier Rode","latitude":5.331807,"longitude":-4.373856,"_id":655712371,"_uuid":"eee30976-b4b4-4fec-8213-e96cd8e23c2c","_index":1}},{"type":"Feature","id":"donneetudiant.2","geometry":{"type":"Point","coordinates":[-4.102294,5.326551]},"geometry_name":"wkb_geometry","properties":{"nom":"DANO BAHON GRACE LESLIE","genre":"F√©minin","email":"bahon.dano@uvci.edu.ci","niveau":"Licence 1","specialite":"ISN-STG","photo":"1000038974-22_58_53.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/655712813/attachments/attH9aWiiMYgpLnJnnnLUE7h/","ville":"ABIDJAN","ville_1":null,"commune":"YOPOUGON","quartier":"niongon nord lubafrique","latitude":5.326551,"longitude":-4.102294,"_id":655712813,"_uuid":"15b532c0-1049-433b-8cb9-64ba34546d55","_index":2}},{"type":"Feature","id":"donneetudiant.3","geometry":{"type":"Point","coordinates":[-3.567682,5.293969]},"geometry_name":"wkb_geometry","properties":{"nom":"KOUASSI DJEDJE SAMUEL","genre":"Masculin","email":"djedje.kouassi@uvci.edu.ci","niveau":"Licence 1","specialite":"ISN-RSI","photo":"541067-23_0_43.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/655713076/attachments/attfTgvqmqjMvUDje3544yfk/","ville":"AUTRE","ville_1":"BONOUA","commune":null,"quartier":"C√©leste","latitude":5.293969,"longitude":-3.567682,"_id":655713076,"_uuid":"f6be8cf8-343d-4f8f-80e8-a8c2947d02ac","_index":3}},{"type":"Feature","id":"donneetudiant.4","geometry":{"type":"Point","coordinates":[-4.001079,5.402271]},"geometry_name":"wkb_geometry","properties":{"nom":"ADEBAYO MUHAMAD MUJIBU","genre":"Masculin","email":"muhamad1.adebayo@uvci.edu.ci","niveau":"Master 2","specialite":"ISN-BCD","photo":"ID_ADEBAYO (1)-23_15_56.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/655715620/attachments/attwCKtohFbLY5g4NRQgDwPj/","ville":"ABIDJAN","ville_1":null,"commune":"ABOBO","quartier":"Abobo Dokoui","latitude":5.402271,"longitude":-4.001079,"_id":655715620,"_uuid":"d827950b-1ad8-4a50-89a0-57370e27f283","_index":4}},{"type":"Feature","id":"donneetudiant.5","geometry":{"type":"Point","coordinates":[-3.930974,5.365517]},"geometry_name":"wkb_geometry","properties":{"nom":"KPAN MANDOH GRACE","genre":"F√©minin","email":"mandoh1.kpan@uvci.edu.ci","niveau":"Licence 3","specialite":"ISN-STG","photo":"IMG-20230313-WA0016(1)-23_35_38.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/655718421/attachments/att2MaQ8rcUXifkRAon2nTLy/","ville":"ABIDJAN","ville_1":null,"commune":"COCODY","quartier":"Cocody Faya Lauriers 9 D","latitude":5.365517,"longitude":-3.930974,"_id":655718421,"_uuid":"adaf7815-290a-49ab-80ec-d6b53d172c75","_index":5}},{"type":"Feature","id":"donneetudiant.6","geometry":{"type":"Point","coordinates":[-3.992917,5.35457]},"geometry_name":"wkb_geometry","properties":{"nom":"KONAN OPHIR","genre":"Masculin","email":"retsin.konan@uvci.edu.ci","niveau":"Licence 1","specialite":"ISN-RSI","photo":"83ab6de86eb1b0b500e11808e4cf4433-23_52_11.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/655720423/attachments/attHFnHdtYfrf2TfgcxSmask/","ville":"ABIDJAN","ville_1":null,"commune":"COCODY","quartier":"riviera 2","latitude":5.35457,"longitude":-3.992917,"_id":655720423,"_uuid":"6d6f3681-b7c3-48c6-8d21-11f44df1ba6d","_index":6}},{"type":"Feature","id":"donneetudiant.7","geometry":{"type":"Point","coordinates":[-4.108775,5.351654]},"geometry_name":"wkb_geometry","properties":{"nom":"DIARRASSOUBA YASMINE MALONE","genre":"F√©minin","email":"yasmine1.diarrassouba@uvci.edu.ci","niveau":"Licence 3","specialite":"ISN-STG","photo":"IMG_0195-0_48_52.jpeg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/655730282/attachments/attXst4M2yCQvkYYhSbNMY6d/","ville":"ABIDJAN","ville_1":null,"commune":"YOPOUGON","quartier":"Yopougon gesco","latitude":5.351654,"longitude":-4.108775,"_id":655730282,"_uuid":"b44c5f6b-9cc9-41d2-8442-ceba961ae375","_index":7}},{"type":"Feature","id":"donneetudiant.8","geometry":{"type":"Point","coordinates":[-4.035188,5.312635]},"geometry_name":"wkb_geometry","properties":{"nom":"YAO ALLOU LOIC EMMANUEL","genre":"Masculin","email":"allou.yao@uvci.edu.ci","niveau":"Licence 3","specialite":"ISN-DAS","photo":"1000962100-7_11_47.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/655854190/attachments/att5oL5SEBoQRM8Q7EZVwJPk/","ville":"ABIDJAN","ville_1":null,"commune":"COCODY","quartier":"Angre Mahou","latitude":5.312635,"longitude":-4.035188,"_id":655854190,"_uuid":"b3fb9469-d2a5-46ab-8f72-fcde8a371cc9","_index":8}},{"type":"Feature","id":"donneetudiant.9","geometry":{"type":"Point","coordinates":[-6.827563,5.578651]},"geometry_name":"wkb_geometry","properties":{"nom":"KOUI GONKAPIEU","genre":"Masculin","email":"gonkapieu.koui@uvci.edu.ci","niveau":"Licence 3","specialite":"ISN-STG","photo":"17694258278452820200748417979458-11_11_9.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/656047431/attachments/attmuo4dozhhfAcqbivrtpht/","ville":"SOUBRE","ville_1":null,"commune":null,"quartier":"Walebo","latitude":5.578651,"longitude":-6.827563,"_id":656047431,"_uuid":"b55eceb3-08ca-450b-ac3a-acb868328e6f","_index":9}},{"type":"Feature","id":"donneetudiant.10","geometry":{"type":"Point","coordinates":[-4.008091,5.434319]},"geometry_name":"wkb_geometry","properties":{"nom":"N‚ÄôDOUMI OCHOU ROXAND KEVINE","genre":"Masculin","email":"ochou4.ndoumi@uvci.edu.ci","niveau":"Licence 3","specialite":"ISN-STG","photo":"image-11_23_44.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/656059188/attachments/attDWN9QRQa47WVQSfg64GPz/","ville":"ABIDJAN","ville_1":null,"commune":"ABOBO","quartier":"Abobo plaque 1","latitude":5.434319,"longitude":-4.008091,"_id":656059188,"_uuid":"d334631b-011f-4761-a863-eed60897324d","_index":10}},{"type":"Feature","id":"donneetudiant.11","geometry":{"type":"Point","coordinates":[-5.074788,7.686852]},"geometry_name":"wkb_geometry","properties":{"nom":"N'DEDE AKROMAN ALAIN YVANN YOANN","genre":"Masculin","email":"akroman.ndede@uvci.edu.ci","niveau":"Licence 3","specialite":"ISN-STG","photo":"IMG_20250808_150823~2-11_37_52.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/656068370/attachments/attfPdkNic9aKfb6P96uoLB3/","ville":"ABIDJAN","ville_1":null,"commune":"PORT BOUET","quartier":"Vridi cit√©","latitude":7.686852,"longitude":-5.074788,"_id":656068370,"_uuid":"45013954-3e99-4443-967f-1b8508188f9e","_index":11}},{"type":"Feature","id":"donneetudiant.12","geometry":{"type":"Point","coordinates":[-2.998253,9.270588]},"geometry_name":"wkb_geometry","properties":{"nom":"PALE ERY VALENTINE","genre":"F√©minin","email":"Ery.pale@uvci.edu.ci","niveau":"Licence 1","specialite":"ISN-STG","photo":"IMG_20250725_123945 (1)-11_43_42.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/656073616/attachments/attqeJryenX6vVhDQz2m32g3/","ville":"BOUNA","ville_1":null,"commune":null,"quartier":"Sogephia","latitude":9.270588,"longitude":-2.998253,"_id":656073616,"_uuid":"edab02b6-7701-41ac-8cd2-7b053bb70e64","_index":12}},{"type":"Feature","id":"donneetudiant.13","geometry":{"type":"Point","coordinates":[-3.996967,5.382126]},"geometry_name":"wkb_geometry","properties":{"nom":"DIABATE GEREMIE","genre":"Masculin","email":"jeremie.diabate@uvci.edu.ci","niveau":"Licence 2","specialite":"ISN-STG","photo":"ma_photo_c-12_25_44.png","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/656116183/attachments/attpSQRfEaPaqVrzjgzdYQ6G/","ville":"ABIDJAN","ville_1":null,"commune":"COCODY","quartier":"Cocody Aghien","latitude":5.382126,"longitude":-3.996967,"_id":656116183,"_uuid":"f68b6437-0be9-4fb1-ba76-40bc5dc4c6f4","_index":13}},{"type":"Feature","id":"donneetudiant.14","geometry":{"type":"Point","coordinates":[-7.549642,7.412421]},"geometry_name":"wkb_geometry","properties":{"nom":"SAHI MICHEL GUIAGNI","genre":"Masculin","email":"sahimichelguiagni@gmail.com","niveau":"Licence 1","specialite":"ISN-STG","photo":"1000089648-12_29_13.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/656117239/attachments/attpQZKLhFfTx3zr3SoZYQwj/","ville":"MAN","ville_1":null,"commune":null,"quartier":"Mangouin yrongouin","latitude":7.412421,"longitude":-7.549642,"_id":656117239,"_uuid":"20689e08-326c-41d1-a6ae-b0098bcea835","_index":14}},{"type":"Feature","id":"donneetudiant.15","geometry":{"type":"Point","coordinates":[-5.727185,9.89454]},"geometry_name":"wkb_geometry","properties":{"nom":"KLA RODRIGUE ARMAND","genre":"Masculin","email":"rodrigue.kla@uvci.edu.ci","niveau":"Licence 2","specialite":"ISN-STG","photo":"17694314259861372085291720263666-12_43_58.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/656131804/attachments/attFyNoAHjpKxSkVLhuaUYj4/","ville":"KORHOGO","ville_1":null,"commune":null,"quartier":"Tongon","latitude":9.89454,"longitude":-5.727185,"_id":656131804,"_uuid":"8f89c71d-0ce8-4e6c-9cf2-42fae0b1e4a5","_index":15}},{"type":"Feature","id":"donneetudiant.16","geometry":{"type":"Point","coordinates":[-4.005135,5.410401]},"geometry_name":"wkb_geometry","properties":{"nom":"KOUAO N'DA","genre":"Masculin","email":"nda.kouao@uvci.edu.ci","niveau":"Licence 2","specialite":"ISN-DAS","photo":"IMG_20240915_132600~2-13_8_9.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/656156494/attachments/attxSQZWknLVCm3m7TKJqrxg/","ville":"ABIDJAN","ville_1":null,"commune":"ABOBO","quartier":"Abobote","latitude":5.410401,"longitude":-4.005135,"_id":656156494,"_uuid":"0f2d0d7d-c200-4e5f-8fe9-6fc5a8742b2f","_index":16}},{"type":"Feature","id":"donneetudiant.17","geometry":{"type":"Point","coordinates":[-4.076005,5.433541]},"geometry_name":"wkb_geometry","properties":{"nom":"TANOH DORGELES","genre":"Masculin","email":"dorgeles.tanoh@uvci.edu.ci","niveau":"Licence 1","specialite":"ISN-STG","photo":"WIN_20260126_13_15_47_Pro-13_18_36.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/656165463/attachments/attjfJA2GbhRyXXSpcvokczL/","ville":"ABIDJAN","ville_1":null,"commune":"ABOBO","quartier":"N'dotre","latitude":5.433541,"longitude":-4.076005,"_id":656165463,"_uuid":"d3d8d867-45c1-4268-a7fc-e654b2252016","_index":17}},{"type":"Feature","id":"donneetudiant.18","geometry":{"type":"Point","coordinates":[-4.085891,5.454607]},"geometry_name":"wkb_geometry","properties":{"nom":"OUATTARA YIGUELEHO","genre":"Masculin","email":"yigueleho.ouattara@uvci.edu.ci","niveau":"Licence 2","specialite":"ISN-STG","photo":"IMG_20251128_133825_172-13_20_33.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/656167744/attachments/attwaLciJ4twt3DB4Ta4Kzp4/","ville":"ABIDJAN","ville_1":null,"commune":"YOPOUGON","quartier":"Anyama √âbimp√©","latitude":5.454607,"longitude":-4.085891,"_id":656167744,"_uuid":"86058f0e-79cd-4bb9-a654-cea6d3aa6266","_index":18}},{"type":"Feature","id":"donneetudiant.19","geometry":{"type":"Point","coordinates":[-4.004175,5.452795]},"geometry_name":"wkb_geometry","properties":{"nom":"NGUESSAN  PRISCILLE","genre":"F√©minin","email":"priscille.nguessan@uvci.edu.ci","niveau":"Licence 3","specialite":"ISN-BD","photo":"IMG_20260126_173540-17_36_2-17_48_9.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/656405309/attachments/attDz9CcBwyjwkEGLr5qRGGv/","ville":"ABIDJAN","ville_1":null,"commune":"ABOBO","quartier":"Abobo Djibi","latitude":5.452795,"longitude":-4.004175,"_id":656405309,"_uuid":"8687de46-cdb1-46cc-b571-86b5f5b768b1","_index":19}},{"type":"Feature","id":"donneetudiant.20","geometry":{"type":"Point","coordinates":[7.3,4.6]},"geometry_name":"wkb_geometry","properties":{"nom":"KONE BASSARA","genre":"F√©minin","email":"bassara.kone@uvci.edu.ci","niveau":"Licence 1","specialite":"ISN-STG","photo":"Snapchat-997621022-19_49_34.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/656467168/attachments/attcFsqPvFNWqqMWZkxbbbCy/","ville":"DALOA","ville_1":null,"commune":null,"quartier":"Quartier millionnaire","latitude":4.6,"longitude":7.3,"_id":656467168,"_uuid":"d002102a-0ae5-4f22-9751-05644fb08afa","_index":20}},{"type":"Feature","id":"donneetudiant.21","geometry":{"type":"Point","coordinates":[-4.102294,5.329486]},"geometry_name":"wkb_geometry","properties":{"nom":"KOUAME N'DA YAO PAUL","genre":"Masculin","email":"nda8.kouame@uvci.edu.ci","niveau":"Licence 3","specialite":"ISN-ATD","photo":"17248-20_27_24.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/656484355/attachments/attMUPKYybvjdPabzhw7zh9A/","ville":"ABIDJAN","ville_1":null,"commune":"YOPOUGON","quartier":"Niangon Nord","latitude":5.329486,"longitude":-4.102294,"_id":656484355,"_uuid":"029083fd-87a8-4f76-b03a-b8c34a9b4a7a","_index":21}},{"type":"Feature","id":"donneetudiant.22","geometry":{"type":"Point","coordinates":[-7.359087,6.743352]},"geometry_name":"wkb_geometry","properties":{"nom":"KAMBOU SAMI ARNAUD","genre":"Masculin","email":"sami1.kambou@uvci.edu.ci","niveau":"Licence 3","specialite":"ISN-STG","photo":"IMG_1546-22_19_45.png","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/656520692/attachments/atteD2kNZK3X4RaPPeMegiyp/","ville":"DUEKOUE","ville_1":null,"commune":null,"quartier":"Centrale","latitude":6.743352,"longitude":-7.359087,"_id":656520692,"_uuid":"57d4046b-1c9b-4723-aab3-6aa3d4a71068","_index":22}},{"type":"Feature","id":"donneetudiant.23","geometry":{"type":"Point","coordinates":[-4.011341,5.444917]},"geometry_name":"wkb_geometry","properties":{"nom":"COULIBALY NENOU","genre":"Masculin","email":"nenou.coulibaly@uvci.edu.ci","niveau":"Licence 3","specialite":"ISN-STG","photo":"WhatsApp Image 2025-03-27 √† 11.55.34_b7abb681-11_56_5.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/656538945/attachments/attDQ3wEajg5roRGTLf5wMrv/","ville":"ABIDJAN","ville_1":null,"commune":"ABOBO","quartier":"Abobo Colatier","latitude":5.444917,"longitude":-4.011341,"_id":656538945,"_uuid":"ea07b7aa-7845-4038-a036-4cfb411724b2","_index":23}},{"type":"Feature","id":"donneetudiant.24","geometry":{"type":"Point","coordinates":[-4.007478,5.433647]},"geometry_name":"wkb_geometry","properties":{"nom":"ADON ELVIS LEONARD","genre":"Masculin","email":"elvis.adon@uvci.edu.ci","niveau":"Licence 2","specialite":"ISN-RSI","photo":"136163-13_42_18.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/657084371/attachments/attrpYLeKaf6z37AdHBvoRBX/","ville":"ABIDJAN","ville_1":null,"commune":"ABOBO","quartier":"Abobo plaque 1","latitude":5.433647,"longitude":-4.007478,"_id":657084371,"_uuid":"53d5a025-c362-4964-8502-93594327810c","_index":24}},{"type":"Feature","id":"donneetudiant.25","geometry":{"type":"Point","coordinates":[-4.014865,5.406789]},"geometry_name":"wkb_geometry","properties":{"nom":"TRAORE ABDUL KADER","genre":"Masculin","email":"abdul.traore@uvci.edu.ci","niveau":"Licence 2","specialite":"ISN-RSI","photo":"9453e90f-973e-4faf-af62-9c5d89a98208-1_all_34-15_39_48.jpg","photo_1":"https://kf.kobotoolbox.org/api/v2/assets/a6WVDWu7Ystdpcns2LhJVk/data/657220331/attachments/attzmYAXAmnJssxfbRapnZRs/","ville":"ABIDJAN","ville_1":null,"commune":"ANYAMA","quartier":"Anyama shineider","latitude":5.406789,"longitude":-4.014865,"_id":657220331,"_uuid":"b13f7fea-0f4c-4a7b-992c-69c99b4bf70c","_index":25}}],"totalFeatures":25,"numberMatched":25,"numberReturned":25,"timeStamp":"2026-01-27T22:15:14.523Z","crs":{"type":"name","properties":{"name":"urn:ogc:def:crs:EPSG::4326"}}};

        var map = L.map('map').setView([7.53, -5.54], 7);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        var geojsonLayer, genreChart;
        var iconNorm = L.icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-violet.png', iconSize: [15, 25], iconAnchor: [7, 25] });
        var iconSel = L.icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png', iconSize: [18, 30], iconAnchor: [9, 30] });

        function initStats(data) {
            document.getElementById('total-count').innerText = data.length;
            var h = data.filter(f => (f.properties.genre || "").startsWith('M')).length;
            var f = data.filter(f => (f.properties.genre || "").startsWith('F')).length;
            document.getElementById('stat-text').innerHTML = `<b>${h}</b> Hommes | <b>${f}</b> Femmes`;

            if (genreChart) genreChart.destroy();
            genreChart = new Chart(document.getElementById('genreChart'), {
                type: 'doughnut',
                data: { labels: ['H', 'F'], datasets: [{ data: [h, f], backgroundColor: ['#2ecc71', '#7F00FF'] }] },
                options: { plugins: { legend: { display: false } }, cutout: '70%' }
            });
        }

        function afficher(data) {
            if (geojsonLayer) map.removeLayer(geojsonLayer);
            initStats(data.features);
            geojsonLayer = L.geoJSON(data, {
                pointToLayer: (f, latlng) => L.marker(latlng, { icon: iconNorm }),
                onEachFeature: (f, layer) => {
                    layer.bindPopup(`<b>${f.properties.nom}</b><br>${f.properties.ville}`);
                    layer.on('mouseover', function() { this.setIcon(iconSel); this.openPopup(); });
                    layer.on('mouseout', function() { this.setIcon(iconNorm); this.closePopup(); });
                }
            }).addTo(map);
        }

        function filtrer() {
            var txt = document.getElementById('search').value.toLowerCase();
            var filtered = mesDonnees.features.filter(f => f.properties.nom.toLowerCase().includes(txt));
            afficher({ type: "FeatureCollection", features: filtered });
        }

        function exportData() {
            let csv = "Nom,Genre,Niveau,Ville\n" + mesDonnees.features.map(f => `${f.properties.nom},${f.properties.genre},${f.properties.niveau},${f.properties.ville}`).join("\n");
            let link = document.createElement("a");
            link.href = "data:text/csv;charset=utf-8," + encodeURI(csv);
            link.download = "export_uvci.csv";
            link.click();
        }

        afficher(mesDonnees);
    </script>
</body>
</html>
